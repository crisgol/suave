<script>
  import { getContext } from 'svelte';
  import { without } from './utils';
  import { Router } from './Router.html';

  export let path;
  export let component;
  let props;

  const router = getContext(Router);
  const match = router.register(props.default ? '*' : path, component);

  let passthrough;
  $: passthrough = without(props, ['path', 'component', 'default']);
</script>

<svelte:meta bind:props />

{#if $match}
  {#if $match.component}
    {#await $match.component}
      <slot name="loading" {...$match.params} />
    {:then { Component, preloaded = {} }}
      <Component {...preloaded} {...passthrough}><slot {...$match.params} /></Component>
    {:catch error}
      <!-- TODO -->
    {/await}
  {:else}
    <slot {...$match.params} />
  {/if}
{/if}
